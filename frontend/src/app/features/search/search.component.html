<div class="search-container">
  <h1>Search Food</h1>

  <div class="search-box">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (keyup.enter)="handleSearch()"
      placeholder="Enter barcode or search by name..."
      class="search-input"
      autocomplete="off">
    <button (click)="handleSearch()" class="btn btn-primary" [disabled]="!searchQuery.trim()">
      üîç Search
    </button>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Searching for products...</p>

    <!-- Skeleton Cards -->
    <div style="max-width: 600px; margin: 2rem auto;">
      <div class="skeleton-card" *ngFor="let item of [1,2,3]">
        <div class="skeleton-image skeleton"></div>
        <div class="skeleton-text">
          <div class="skeleton-line skeleton"></div>
          <div class="skeleton-line skeleton short"></div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="error" class="error">{{error}}</div>

  <!-- Live Search Suggestions with Images -->
  <div *ngIf="searchResults.length > 0 && !currentFood && !showingBarcodeResult" class="suggestions-dropdown">
    <div class="suggestions-header">
      <h3>{{searchResults.length}} Suggestions</h3>
      <span class="hint">Click to view details</span>
    </div>
    <div class="suggestions-list">
      <div *ngFor="let food of searchResults; let i = index"
           class="suggestion-item"
           (click)="viewFoodDetails(food)">
        <div class="suggestion-number">{{i + 1}}</div>

        <!-- Product Image -->
        <div class="suggestion-image">
          <img
            *ngIf="food.image_url"
            [src]="food.image_url"
            [alt]="food.product_name"
            (error)="onImageError($event)"
            loading="lazy">
          <div *ngIf="!food.image_url" class="no-image">
            üçΩÔ∏è
          </div>
        </div>

        <div class="suggestion-content">
          <h4>{{food.product_name}}</h4>
          <p class="suggestion-meta">
            <span class="badge">{{food.energy_kcal || 0}} kcal</span>
            <span class="badge">{{food.protein || 0}}g protein</span>
            <span class="badge" *ngIf="food.carbohydrates">{{food.carbohydrates}}g carbs</span>
            <span class="badge" *ngIf="food.fat">{{food.fat}}g fat</span>
          </p>
        </div>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M7 7l3 3 3-3" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Selected Food Detail with Image -->
  <div *ngIf="currentFood" class="food-detail">
    <div class="food-detail-header">
      <div class="header-content">
        <!-- Large Product Image -->
        <div class="product-image-large">
          <img
            *ngIf="currentFood.image_url"
            [src]="currentFood.image_url"
            [alt]="currentFood.product_name"
            (error)="onImageError($event)">
          <div *ngIf="!currentFood.image_url" class="no-image-large">
            üçΩÔ∏è
          </div>
        </div>

        <div class="header-text">
          <h2>{{currentFood.product_name}}</h2>
          <p class="barcode-info">Barcode: {{currentFood.barcode || 'N/A'}}</p>
        </div>
      </div>
      <button (click)="clearSelection()" class="btn-close" title="Close">‚úï</button>
    </div>

    <div class="nutrition-section">
      <h3>Nutritional Information (per 100g)</h3>
      <div class="nutrition-grid">
        <div class="nutrition-item">
          <span class="label">Calories</span>
          <span class="value">{{currentFood.energy_kcal || 0}}</span>
          <span class="unit">kcal</span>
        </div>
        <div class="nutrition-item">
          <span class="label">Protein</span>
          <span class="value">{{currentFood.protein || 0}}</span>
          <span class="unit">g</span>
        </div>
        <div class="nutrition-item">
          <span class="label">Carbs</span>
          <span class="value">{{currentFood.carbohydrates || 0}}</span>
          <span class="unit">g</span>
        </div>
        <div class="nutrition-item">
          <span class="label">Fat</span>
          <span class="value">{{currentFood.fat || 0}}</span>
          <span class="unit">g</span>
        </div>
        <div class="nutrition-item" *ngIf="currentFood.sugars">
          <span class="label">Sugars</span>
          <span class="value">{{currentFood.sugars}}</span>
          <span class="unit">g</span>
        </div>
        <div class="nutrition-item" *ngIf="currentFood.fiber">
          <span class="label">Fiber</span>
          <span class="value">{{currentFood.fiber}}</span>
          <span class="unit">g</span>
        </div>
        <div class="nutrition-item" *ngIf="currentFood.salt">
          <span class="label">Salt</span>
          <span class="value">{{currentFood.salt}}</span>
          <span class="unit">g</span>
        </div>
      </div>
    </div>

    <!-- Add to Log Section (keep as before) -->
    <div class="log-section">
      <h3>üìù Add to Daily Log</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Serving Size (g):</label>
          <input type="number" [(ngModel)]="servingSize" min="1" class="input" placeholder="100">
          <small class="helper-text">
            = {{calculateCalories()}} kcal, {{calculateProtein()}}g protein
          </small>
        </div>
        <div class="form-group">
          <label>Meal Type:</label>
          <select [(ngModel)]="mealType" class="input">
            <option value="breakfast">üç≥ Breakfast</option>
            <option value="lunch">üçΩÔ∏è Lunch</option>
            <option value="dinner">üç¥ Dinner</option>
            <option value="snack">üç™ Snack</option>
          </select>
        </div>
      </div>
      <button (click)="logFood()" class="btn btn-success">
        ‚ûï Add to My Daily Log
      </button>
    </div>
  </div>

  <!-- No results message -->
  <div *ngIf="searchAttempted && searchResults.length === 0 && !currentFood && !loading" class="no-results">
    <p>üòï No results found for "{{lastSearchQuery}}"</p>
    <p class="hint">Try searching with a barcode or different product name</p>
  </div>
</div>
